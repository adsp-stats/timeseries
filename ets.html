<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ETS models – Forecasting Essentials and Notes: Online Resource</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sarima.html" rel="next">
<link href="./identificationinr.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-635ebee939b5a5ef3c54ffc98530d095.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ets.html">3. ETS and SARIMA models</a></li><li class="breadcrumb-item"><a href="./ets.html"><span class="chapter-title">ETS models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Forecasting Essentials and Notes: Online Resource</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">1. Time series basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whatisatimeseries.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">What is a time series?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./autocovariance.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Autocovariance and autocorrelation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whitenoise.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">White noise</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./randomwalk.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Random walks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stationarity.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Stationarity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basicsinr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Time series basics in R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">2. ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ar.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">AR models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ma.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">MA models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./backshift.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Backshift notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arima.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ARIMA models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./identificationinr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ARIMA identification in R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">3. ETS and SARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ets.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">ETS models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sarima.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">SARIMA models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./seasonalityinr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Seasonal models in R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Forecasting and validation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forecasts.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Forecast strategies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Model validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validationinr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Validation in R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#simple-exponential-smoothing" id="toc-simple-exponential-smoothing" class="nav-link active" data-scroll-target="#simple-exponential-smoothing">Simple exponential smoothing</a></li>
  <li><a href="#estimating-an-exponential-smoothing-model" id="toc-estimating-an-exponential-smoothing-model" class="nav-link" data-scroll-target="#estimating-an-exponential-smoothing-model">Estimating an exponential smoothing model</a></li>
  <li><a href="#adding-a-trend-component" id="toc-adding-a-trend-component" class="nav-link" data-scroll-target="#adding-a-trend-component">Adding a trend component</a></li>
  <li><a href="#adding-a-damped-trend-component" id="toc-adding-a-damped-trend-component" class="nav-link" data-scroll-target="#adding-a-damped-trend-component">Adding a damped trend component</a></li>
  <li><a href="#adding-an-additive-seasonal-component-holt-winters-models" id="toc-adding-an-additive-seasonal-component-holt-winters-models" class="nav-link" data-scroll-target="#adding-an-additive-seasonal-component-holt-winters-models">Adding an additive seasonal component (Holt-Winters models)</a></li>
  <li><a href="#exponential-smoothing-models-with-multiplicative-components" id="toc-exponential-smoothing-models-with-multiplicative-components" class="nav-link" data-scroll-target="#exponential-smoothing-models-with-multiplicative-components">Exponential smoothing models with multiplicative components</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ets.html">3. ETS and SARIMA models</a></li><li class="breadcrumb-item"><a href="./ets.html"><span class="chapter-title">ETS models</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">ETS models</span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Having learned one major class of time series models — <a href="./arima.html">ARIMA models</a> — let’s learn a second class of models to compare and contrast. This new group of models is collectively referred to as <em>exponential smoothing</em>. These models are sometimes also called “ETS” which stands for <em>error, trend, seasonality</em>.</p>
<section id="simple-exponential-smoothing" class="level2">
<h2 class="anchored" data-anchor-id="simple-exponential-smoothing">Simple exponential smoothing</h2>
<p>The motivation for exponential smoothing is <a href="https://otexts.com/fpp3/ses.html">described well by Hyndman and Athansopoulous</a> when they note the usefulness of a middle ground between two simple forecasting methods: dragging the last observations, and averaging the whole series:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0117</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.9</span>),<span class="dv">50</span>)[<span class="dv">5</span><span class="sc">:</span><span class="dv">40</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">'Forecasting from last observation'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">36</span>,<span class="dv">45</span>),<span class="at">y=</span><span class="fu">rep</span>(y[<span class="dv">36</span>],<span class="dv">2</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span><span class="dv">36</span>,<span class="at">y=</span>y[<span class="dv">36</span>],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">cex=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#7f7f7f'</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">'Forecasting from series average'</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">36</span>,<span class="dv">45</span>),<span class="at">y=</span><span class="fu">rep</span>(<span class="fu">mean</span>(y),<span class="dv">2</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">36</span>),<span class="at">y=</span><span class="fu">rep</span>(<span class="fu">mean</span>(y),<span class="dv">2</span>),<span class="at">col=</span><span class="st">'#7f7f7f'</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Simple forecasting strategies</figcaption>
</figure>
</div>
</div>
</div>
<p>The last observation tends to overfit — time series rarely stay in exactly the same place – and it also ignores the vast majority of the data. The series average tends to underfit — it doesn’t use any time series information at all — and it equally weights observations which may no longer be relevant.</p>
<p>There is a middle way. The most recent observation can get <em>the most weight</em>, and yet all observations will get <em>some weight</em>, with older observations receiving <em>exponentially less weight</em>:</p>
<p><span class="math display">\[\hat{y}_{t+1} = \alpha y_t + \alpha (1 - \alpha) y_{t-1} + \alpha (1 - \alpha)^2 y_{t-2} + \ldots\]</span></p>
<p>Let us note a few properties of this equation before going further:</p>
<ul>
<li><p>I have written the equation using <span class="math inline">\(y_t\)</span> instead of <span class="math inline">\(Y_t\)</span>, signaling to you that we need not associate this time series with probability distributions of a set of random variables. We can view exponential smoothing as a type of machine learning model, not parametric statistical inference.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p></li>
<li><p>The sum of the weights, <span class="math inline">\(\sum_{i=0}^\infty \alpha (1 - \alpha)^i\)</span> will add up to 1 only when <span class="math inline">\(\alpha \in (0,1)\)</span> and when the series is truly infinite. However, our sample of data is finite, so the weights of our smoothing will not <em>exactly</em> equal 1.</p></li>
<li><p>At this time, the equation does not account for any trend over time or any seasonality. In other words, the forecast for <em>all</em> future forecast periods will be equal to the forecast for time <span class="math inline">\(t+1\)</span>.</p></li>
</ul>
<p>By changing <span class="math inline">\(\alpha\)</span> we can change the “memory” of the equation. Higher values of <span class="math inline">\(\alpha\)</span> correspond to a short memory, closer to the last observation. Lower values of <span class="math inline">\(\alpha\)</span> correspond to a long memory, closer to the series average:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ses80 <span class="ot">&lt;-</span> y<span class="sc">%*%</span>(<span class="fl">0.8</span><span class="sc">*</span><span class="fl">0.2</span><span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ses20 <span class="ot">&lt;-</span> y<span class="sc">%*%</span>(<span class="fl">0.2</span><span class="sc">*</span><span class="fl">0.8</span><span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'SES using '</span>,alpha <span class="sc">==</span> <span class="fl">0.8</span>)))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">36</span>,<span class="dv">45</span>),<span class="at">y=</span><span class="fu">rep</span>(ses80,<span class="dv">2</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>,<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.8</span><span class="sc">*</span><span class="fl">0.2</span><span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="fl">2.8</span>,<span class="st">'Weights'</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'SES using '</span>,alpha <span class="sc">==</span> <span class="fl">0.2</span>)))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">36</span>,<span class="dv">45</span>),<span class="at">y=</span><span class="fu">rep</span>(ses20,<span class="dv">2</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>,<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.2</span><span class="sc">*</span><span class="fl">0.8</span><span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="fl">2.8</span>,<span class="st">'Weights'</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Simple exponential smoothing models</figcaption>
</figure>
</div>
</div>
</div>
<p>Hyndman and Athansopoulos reformulate exponential smoothing into two phases. First, they define a <em>smoothing series</em> which iterates over each observation in the data, using the previous smoothing series value to help estimate the next smoothing series value. Second, they define a <em>forecasting equation</em> which uses the smoothing series to predict arbitrarily far into the future from any point.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(\boldsymbol{y}\)</span> be a time series observed during the regular time periods <span class="math inline">\(T = \{1, 2, \ldots, n\}\)</span>. For some parameters <span class="math inline">\(\alpha \in (0,1)\)</span> and <span class="math inline">\(\ell_0 \in \mathbb{R}\)</span>, iteratively define the smoothing series <span class="math inline">\(\boldsymbol{\ell}\)</span> as follows:</p>
<p><span class="math display">\[\ell_t = \alpha y_t + (1 - \alpha) \ell_{t-1}\]</span></p>
<p>And for a specific time index <span class="math inline">\(\tau\)</span> and an integer look-ahead period <span class="math inline">\(h\)</span>, define the forecasting series <span class="math inline">\(\hat{y}_{\tau+h|\tau}\)</span> as follows:</p>
<p><span class="math display">\[\hat{y}_{\tau+h|\tau} = \ell_\tau\]</span></p>
<p>Together, we refer to these two series as a <strong>simple exponential smoothing (SES) model</strong>.</p>
</div>
</div>
<p>(This may feel very anticlimactic or unnecessarily complicated, but it is a scaffolding on which we will build features to capture trend and seasonality.)</p>
</section>
<section id="estimating-an-exponential-smoothing-model" class="level2">
<h2 class="anchored" data-anchor-id="estimating-an-exponential-smoothing-model">Estimating an exponential smoothing model</h2>
<p>Recently, exponential smoothing models have been <a href="https://robjhyndman.com/expsmooth/">synthesized with state space models</a>, which allows them to be solved using methods common to the rest of statistical inference: distributional assumptions followed by likelihood optimization (including partial, quasi, or conditional likelihood) <em>via</em> gradient descent or other search techniques.</p>
<p>However, we will discuss more basic techniques here which do not require distributional theory.</p>
<p>The forecasting method above suggests an error equation for each observation <span class="math inline">\(y_t\)</span> as compared to its prior-period forecast, <span class="math inline">\(\hat{y}_{t|t-1}\)</span>:</p>
<p><span class="math display">\[e_t = y_t - \hat{y}_{t|t-1}; \qquad \textrm{SSE} = \sum_{t=1}^n e_t^2\]</span></p>
<p>The two parameters which control this sum of squared errors are <span class="math inline">\(\alpha\)</span>, the smoothing parameter, and <span class="math inline">\(\ell_0\)</span>, the choice of the initial level (recall that each <span class="math inline">\(\ell_i\)</span> is defined iteratively, and so there is no definition for <span class="math inline">\(\ell_0\)</span>). Therefore, using a Least Squares solution method, we may estimate:</p>
<p><span class="math display">\[\hat{\alpha}, \hat{\ell}_0 = \mathop{\textrm{argmin}}_{\alpha \in (0,1); \ell \in \mathbb{R}} \textrm{SSE}\]</span></p>
<p>Although this optimization cannot be solved as easily as OLS equations (we do not have a closed form solution which works for every dataset, such as <span class="math inline">\(\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^t\boldsymbol{y}\)</span>), we can still solve easily enough with algorithmic techniques.</p>
</section>
<section id="adding-a-trend-component" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-trend-component">Adding a trend component</h2>
<p>When our data trend in one direction due to random walk behavior, we should not incorporate the seeming trend into our predictions, but when the data trend due to deterministic drift, then it would make sense to incorporate this trend into our forecasts.</p>
<p>The slope of the trend will depend on which observations we use as our training sample. Just as before, we have a choice between using <em>all</em> of the data (underfitting) or only <em>the most recent data</em> (overfitting). And just as before, it makes sense to split the difference with another exponential smoothing filter:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(\boldsymbol{y}\)</span> be a time series observed during the regular time periods <span class="math inline">\(T = \{1, 2, \ldots, n\}\)</span>. For some parameters <span class="math inline">\(\alpha, \beta \in (0,1)\)</span> and <span class="math inline">\(\ell_0, b_0 \in \mathbb{R}\)</span>, iteratively define the level series <span class="math inline">\(\boldsymbol{\ell}\)</span> and the trend series <span class="math inline">\(\boldsymbol{b}\)</span> as follows:</p>
<p><span class="math display">\[\ell_t = \alpha y_t + (1 - \alpha)(\ell_{t-1} + b_{t-1})\]</span></p>
<p><span class="math display">\[b_t = \beta(\ell_t - \ell_{t-1}) + (1 - \beta)b_{t-1}\]</span></p>
<p>And for a specific time index <span class="math inline">\(\tau\)</span> and an integer look-ahead period <span class="math inline">\(h\)</span>, define the forecasting series <span class="math inline">\(\hat{y}_{\tau+h|\tau}\)</span> as follows:</p>
<p><span class="math display">\[\hat{y}_{\tau+h|\tau} = \ell_\tau + hb_t\]</span></p>
<p>Together, we refer to these three series as an <strong>exponential smoothing (SES) model with linear trend</strong>.</p>
</div>
</div>
<p>Notice that the new level estimate at each time period is a weighted average between <em>(i)</em> the current observation and <em>(ii)</em> the predicted value of the same observation. Likewise, the new trend estimate at each time period is a weighted average between <em>(i)</em> the most current change in the estimated levels and <em>(ii)</em> the predicted value of the same change in levels.</p>
<p>To estimate this model we would solve a least squares equation for <span class="math inline">\(\hat{\alpha}, \hat{\beta}, \hat{\ell}_0, \textrm{and } \hat{b}_0\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>trend1 <span class="ot">&lt;-</span> <span class="fu">ets</span>(y,<span class="at">model=</span><span class="st">'AAN'</span>,<span class="at">damped=</span><span class="cn">FALSE</span>,<span class="at">alpha=</span><span class="fl">0.4</span>,<span class="at">beta=</span><span class="fl">0.3</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>trend2 <span class="ot">&lt;-</span> <span class="fu">ets</span>(y,<span class="at">model=</span><span class="st">'AAN'</span>,<span class="at">damped=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'ETS using '</span>,<span class="fu">list</span>(alpha <span class="sc">==</span> <span class="fl">0.4</span>, beta <span class="sc">==</span> <span class="fl">0.3</span>))))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">37</span><span class="sc">:</span><span class="dv">45</span>),<span class="at">y=</span><span class="fu">forecast</span>(trend1,<span class="at">h=</span><span class="dv">9</span>)<span class="sc">$</span>mean,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#7f00ff'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="sc">-</span><span class="fl">0.2</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>),<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.4</span><span class="sc">*</span><span class="fl">0.6</span><span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="fl">0.2</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>),<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.3</span><span class="sc">*</span><span class="fl">0.7</span><span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#ff0000'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="fl">2.4</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(alpha,<span class="st">' weights'</span>)),<span class="at">col=</span><span class="st">'#0000ff'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="fl">2.8</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(beta,<span class="st">' weights'</span>)),<span class="at">col=</span><span class="st">'#ff0000'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'ETS using '</span>,<span class="fu">list</span>(alpha <span class="sc">%~~%</span> <span class="fl">0.9</span>, beta <span class="sc">&lt;</span> <span class="fl">0.01</span>))))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">37</span><span class="sc">:</span><span class="dv">45</span>),<span class="at">y=</span><span class="fu">forecast</span>(trend2,<span class="at">h=</span><span class="dv">9</span>)<span class="sc">$</span>mean,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#7f00ff'</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="sc">-</span><span class="fl">0.2</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>),<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="dv">2</span><span class="sc">*</span>trend2<span class="sc">$</span>par[<span class="dv">1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>trend2<span class="sc">$</span>par[<span class="dv">1</span>])<span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#0000ff'</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="fl">0.2</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>),<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="dv">2</span><span class="sc">*</span>trend2<span class="sc">$</span>par[<span class="dv">2</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>trend2<span class="sc">$</span>par[<span class="dv">2</span>])<span class="sc">^</span>(<span class="dv">35</span><span class="sc">:</span><span class="dv">0</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#ff0000'</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="fl">2.4</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(alpha,<span class="st">' weights'</span>)),<span class="at">col=</span><span class="st">'#0000ff'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="fl">2.8</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(beta,<span class="st">' weights'</span>)),<span class="at">col=</span><span class="st">'#ff0000'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Exponential smoothing models with trend</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-a-damped-trend-component" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-damped-trend-component">Adding a damped trend component</h2>
<p>Extrapolating trends into the future is a dangerous business. My newborn daughter has gained about 30 grams (or 1 ounce) per day over the past two weeks. This trend, well-defined over my entire sampling period, suggests that by the time she’s twenty years old, she will weigh 220 kilograms (or 480 pounds).</p>
<p>Because linear extrapolation can so often lead to unrealistic forecasts, sometimes we choose to “dampen” a forecasted trend, meaning that we allow the slope to gradually become flat. The mechanism here will be a new exponential term <span class="math inline">\(\phi\)</span>, which is usually set close to 1. From the equations below you can see that when <span class="math inline">\(\phi \approx 1\)</span> it will not greatly change the iterative smoothing series, but that it will increasingly change the forecasted slope when extrapolating to large look-ahead periods <span class="math inline">\(h\)</span>:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(\boldsymbol{y}\)</span> be a time series observed during the regular time periods <span class="math inline">\(T = \{1, 2, \ldots, n\}\)</span>. For some parameters <span class="math inline">\(\alpha, \beta, \phi \in (0,1)\)</span> and <span class="math inline">\(\ell_0, b_0 \in \mathbb{R}\)</span>, iteratively define the level series <span class="math inline">\(\boldsymbol{\ell}\)</span> and the trend series <span class="math inline">\(\boldsymbol{b}\)</span> as follows:</p>
<p><span class="math display">\[\ell_t = \alpha y_t + (1 - \alpha)(\ell_{t-1} + \phi b_{t-1})\]</span></p>
<p><span class="math display">\[b_t = \beta(\ell_t - \ell_{t-1}) + (1 - \beta) \phi b_{t-1}\]</span></p>
<p>And for a specific time index <span class="math inline">\(\tau\)</span> and an integer look-ahead period <span class="math inline">\(h\)</span>, define the forecasting series <span class="math inline">\(\hat{y}_{\tau+h|\tau}\)</span> as follows:</p>
<p><span class="math display">\[\hat{y}_{\tau+h|\tau} = \ell_\tau + (\phi + \phi^2 + \ldots + \phi^h)b_t\]</span></p>
<p>Together, we refer to these three series as an <strong>exponential smoothing (SES) model with a damped linear trend</strong>.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(forecast)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>trend1 <span class="ot">&lt;-</span> <span class="fu">ets</span>(y,<span class="at">model=</span><span class="st">'AAN'</span>,<span class="at">damped=</span><span class="cn">TRUE</span>,<span class="at">alpha=</span><span class="fl">0.8</span>,<span class="at">beta=</span><span class="fl">0.1</span>,<span class="at">phi=</span><span class="fl">0.95</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>trend2 <span class="ot">&lt;-</span> <span class="fu">ets</span>(y,<span class="at">model=</span><span class="st">'AAN'</span>,<span class="at">damped=</span><span class="cn">TRUE</span>,<span class="at">alpha=</span><span class="fl">0.8</span>,<span class="at">beta=</span><span class="fl">0.1</span>,<span class="at">phi=</span><span class="fl">0.8</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'ETS damped with '</span>,phi <span class="sc">==</span> <span class="fl">0.95</span>)))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">37</span><span class="sc">:</span><span class="dv">45</span>),<span class="at">y=</span><span class="fu">forecast</span>(trend1,<span class="at">h=</span><span class="dv">9</span>)<span class="sc">$</span>mean,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#7f00ff'</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="dv">37</span><span class="sc">:</span><span class="dv">45</span>,<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="fl">0.95</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#7f00ff'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">10</span>,<span class="sc">-</span><span class="fl">2.8</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'weight on '</span>,b[t])),<span class="at">col=</span><span class="st">'#7f00ff'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylab=</span><span class="st">'Y'</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'ETS damped with '</span>,phi <span class="sc">==</span> <span class="fl">0.8</span>)))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">37</span><span class="sc">:</span><span class="dv">45</span>),<span class="at">y=</span><span class="fu">forecast</span>(trend2,<span class="at">h=</span><span class="dv">9</span>)<span class="sc">$</span>mean,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">'#7f00ff'</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="at">x0=</span><span class="dv">37</span><span class="sc">:</span><span class="dv">45</span>,<span class="at">y0=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">y1=</span><span class="fl">0.8</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)<span class="sc">-</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'#7f00ff'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">10</span>,<span class="sc">-</span><span class="fl">2.8</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'weight on '</span>,b[t])),<span class="at">col=</span><span class="st">'#7f00ff'</span>,<span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Exponential smoothing models with trend</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-an-additive-seasonal-component-holt-winters-models" class="level2">
<h2 class="anchored" data-anchor-id="adding-an-additive-seasonal-component-holt-winters-models">Adding an additive seasonal component (Holt-Winters models)</h2>
<p>Often the data show such a clear seasonality (let’s say with period <span class="math inline">\(m\)</span>) that it would be foolish not to use this information when performing forecasting or smoothing the historical values. Once again we are confronted with the dilemma of estimating the seasonality from the entire series (which uses more data, but possibly includes stale data), or estimating the seasonality from only the most recent season (which keeps only the freshest values, but might lose helpful historical context). And once again, we thread the needle by exponentially up-weighting the most recent data and down-weighting the oldest data, using a new smoothing parameter which may be estimated from the data.</p>
<p>Exponential smoothing models with seasonal components are sometimes called <em>Holt-Winters models</em>. Let us start by defining an additive seasonal component.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(\boldsymbol{y}\)</span> be a time series observed during the regular time periods <span class="math inline">\(T = \{1, 2, \ldots, n\}\)</span>. For some parameters <span class="math inline">\(\alpha, \beta, \phi, \gamma \in (0,1)\)</span> and <span class="math inline">\(\ell_0, b_0, s_0, s_{-1}, \ldots, s_{1-m} \in \mathbb{R}\)</span>, iteratively define the level series <span class="math inline">\(\boldsymbol{\ell}\)</span>, the trend series <span class="math inline">\(\boldsymbol{b}\)</span>, and the seasonal series <span class="math inline">\(\boldsymbol{s}\)</span> as follows:</p>
<p><span class="math display">\[\ell_t = \alpha (y_t - s_{t-m}) + (1 - \alpha)(\ell_{t-1} + b_{t-1})\]</span></p>
<p><span class="math display">\[b_t = \beta(\ell_t - \ell_{t-1}) + (1 - \beta) b_{t-1}\]</span></p>
<p><span class="math display">\[s_t = \gamma(y_t - \ell_t) + (1 - \gamma) s_{t-m}\]</span></p>
<p>And for a specific time index <span class="math inline">\(\tau\)</span> and an integer look-ahead period <span class="math inline">\(h\)</span>, define the forecasting series <span class="math inline">\(\hat{y}_{\tau+h|\tau}\)</span> as follows:</p>
<p><span class="math display">\[\hat{y}_{\tau+h|\tau} = \ell_\tau + hb_t + s_{\tau - (h \,\textrm{mod}\, m)}\]</span></p>
<p>Together, we refer to these four series as a <strong>Holt-Winters model with additive seasonality</strong>.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>air.ets1 <span class="ot">&lt;-</span> <span class="fu">ets</span>(AirPassengers,<span class="at">model=</span><span class="st">'AAA'</span>,<span class="at">damped=</span><span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(air.ets1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>ETS model as a sum of three components</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot above shows how an ETS model with trend and seasonality might be fit to a real-world dataset (here, the classic Box-Jenkins dataset of monthly airline passengers). Note that we see signs of an imperfect fit:</p>
<ul>
<li><p>Looking at the top plot of the original data, the seasonal variance seems to be growing proportionally with the mean number of passengers.</p></li>
<li><p>Looking at the bottom plot of the estimated seasonal effects, they seem to be nearly constant over time.</p></li>
<li><p>Looking at the second plot of the estimated level, we see that the level has been co-opted into “fixing” the mistakes being made by the seasonal series. In earlier years the level counteracts the seasonality, muting the effects, while in later years the level complements the seasonality, amplifying the effects.</p></li>
</ul>
<p>This model isn’t necessarily bad, but we might be able to improve it.</p>
</section>
<section id="exponential-smoothing-models-with-multiplicative-components" class="level2">
<h2 class="anchored" data-anchor-id="exponential-smoothing-models-with-multiplicative-components">Exponential smoothing models with multiplicative components</h2>
<p>Sometimes the seasonality effects on a series are additive/linear: for example, the difference between daytime and nighttime temperatures is fairly steady in Chicago whether it’s January (mean temperature 0 C) or July (mean temperature 30 C).</p>
<p>Other times the seasonality effects on a series are multiplicative/proportional: for example, a small florist’s shop might notice a +15% revenue increase in February, around Valentine’s Day. This 15% increase might persist as the business grows from monthly revenues of $10,000 to $100,000 to $1,000,000.</p>
<p>Hyndman and Athanasopoulous present <a href="https://otexts.com/fpp3/holt-winters.html#holt-winters-multiplicative-method">the formulae describing multiplicative seasonality</a> and present <a href="https://otexts.com/fpp3/taxonomy.html">a taxonomy of ETS models</a> which include multiplicative trend effects as well.</p>
<p>Even in cases when seasonality looks multiplicative, a logarithmic (or any appropriate Box-Cox) transformation might convert the series back to additive errors and additive seasonality. Compare three models for the classic Box-Jenkins airline passengers data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>air.ets1 <span class="ot">&lt;-</span> <span class="fu">ets</span>(AirPassengers,<span class="at">model=</span><span class="st">'AAA'</span>,<span class="at">damped=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(air.ets1)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="st">'topleft'</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">'Observations'</span>,<span class="st">'Smoothing fit'</span>),<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">'#000000'</span>,<span class="st">'#0000ff'</span>),<span class="at">bty=</span><span class="st">'n'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>ETS with additive seasonality for original data</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>air.ets2 <span class="ot">&lt;-</span> <span class="fu">ets</span>(AirPassengers,<span class="at">model=</span><span class="st">'AAA'</span>,<span class="at">damped=</span><span class="cn">FALSE</span>,<span class="at">lambda=</span><span class="st">'auto'</span>,<span class="at">biasadj=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(air.ets2)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="st">'topleft'</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">'Observations'</span>,<span class="st">'Smoothing fit'</span>),<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">'#000000'</span>,<span class="st">'#0000ff'</span>),<span class="at">bty=</span><span class="st">'n'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>ETS with additive seasonality for Box-Cox transformed data</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>air.ets3 <span class="ot">&lt;-</span> <span class="fu">ets</span>(AirPassengers,<span class="at">model=</span><span class="st">'MAM'</span>,<span class="at">damped=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(air.ets3)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="st">'topleft'</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">'Observations'</span>,<span class="st">'Smoothing fit'</span>),<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">'#000000'</span>,<span class="st">'#0000ff'</span>),<span class="at">bty=</span><span class="st">'n'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ets_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>ETS with multiplicative trend and seasonality for original data</figcaption>
</figure>
</div>
</div>
</div>
<p>Although all of these models succeed in decomposing or explaining much of the variance in this seasonal time series, we might find ways to choose between them. We could look at which series had the cleanest residual patterns, or best look-ahead forecasting accuracy, or lowest AIC, or (as here) lowest in-sample RMSE:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>air.ets.summ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">sqrt</span>(air.ets1<span class="sc">$</span>mse),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">sqrt</span>(<span class="fu">mean</span>((AirPassengers<span class="sc">-</span>air.ets2<span class="sc">$</span>fitted)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">sqrt</span>(air.ets3<span class="sc">$</span>mse))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(air.ets.summ) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'In-sample RMSE'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(air.ets.summ) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'AAA, no Box-Cox'</span>, <span class="st">'AAA, w/ Box-Cox'</span>, <span class="st">'MAM, no Box-Cox'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(air.ets.summ)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                In-sample RMSE
AAA, no Box-Cox       17.01495
AAA, w/ Box-Cox       10.44758
MAM, no Box-Cox       11.26797</code></pre>
</div>
</div>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>I say we <em>can</em> view them as ML techniques, but it’s also possible to frame them as Gaussian state space models with well-defined distributions and likelihood functions.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Hyndman and Athanasopoulos use an alternative parameterization for <span class="math inline">\(\beta\)</span> which takes a range of <span class="math inline">\((0,\alpha)\)</span>. What these lecture notes refer to as <span class="math inline">\(\beta\)</span> is what their textbook refers to as <span class="math inline">\(\beta^*\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Hyndman and Athanasopoulos use an alternative parameterization for <span class="math inline">\(\gamma\)</span> which takes a range of <span class="math inline">\((0,1-\alpha)\)</span>. What these lecture notes refer to as <span class="math inline">\(\gamma\)</span> is what their textbook refers to as <span class="math inline">\(\gamma^*\)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./identificationinr.html" class="pagination-link" aria-label="ARIMA identification in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">ARIMA identification in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sarima.html" class="pagination-link" aria-label="SARIMA models">
        <span class="nav-page-text"><span class="chapter-title">SARIMA models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>